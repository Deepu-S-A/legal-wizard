<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/dashboard/definitions.css">
  <link rel="stylesheet" href="../assets/css/dashboard/dashboard.css">
  <!-- fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="icon" href="../assets/img/favicon.png" type="image/gif" sizes="16x16">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css" />
  <title>Documentation</title>
  <style>
    .width-70 {
      width: 70%;
      margin: 0 auto;
    }

    .documentation-page-wrap .threedots .options {
      position: absolute;
      top: 1rem;
      left: -5rem;
      right: 0;
    }

    .documentation-page-wrap .box1 {
      background: #FFFFFF;
      border-radius: 22px;
      padding: 1.5rem 1.5rem;
    }

    .box.b1 {
      display: flex;
    }

    .documentation-page-wrap .box.b1 .lhs {
      width: 40%;
      border-right: 1px solid #ccc;
    }

    .documentation-page-wrap .box.b1 .rhs {
      width: 60%;
    }

    .documentation-page-wrap .box.b1 .lhs,
    .box.b1 .rhs {
      padding: 2rem 2rem;
    }

    .documentation-page-wrap .green-circle-sm {
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 0.6rem;
      background: #00AA7A;
      margin-right: 1rem;
    }

    .documentation-page-wrap .key-point.d-flex {
      align-items: center;
      margin-bottom: 1.2rem;
    }

    .documentation-page-wrap .box.b1 .rhs .t16 {
      color: #6B6B6B;
      line-height: 2rem;
      margin-top: 1rem;
    }
    .backToHelpLandingPage{cursor: pointer;}
  </style>
</head>

<body class="documentation-page-wrap">
  <div id="header" class="section" w3-include-html="db-header.html"></div>
  <div class="container-fluid dashboard-container base-container">
    <div class="row">
      <div class="col-md-2 col-sm-12 lhs-home">
        <div class="links-wrap">
          <div class="link active" data-page="overview.html">
            <div class="db-nav-icon home">
              <img src="../assets/img/dashboard/icons/overview.png" alt="" class="Home" />
            </div>
            <div class="t20">Overview</div>
          </div>
          <div class="link" data-page="make-document.html">
            <div class="db-nav-icon mydocument">
              <img src="../assets/img/dashboard/icons/make-document.png" alt="" class="Home" />
            </div>
            <div class="t20">Make document</div>
          </div>
          <div class="link" data-page="my-documents.html">
            <div class="db-nav-icon mydocuments">
              <img src="../assets/img/dashboard/icons/my-document.png" alt="" class="Home" />
            </div>
            <div class="t20">My documents</div>
          </div>
          <div class="link" data-page="doc-business.html">
            <div class="db-nav-icon business">
              <img src="../assets/img/dashboard/icons/business-my-doc.png" alt="" class="Home" />
            </div>
            <div class="t20">Business</div>
            <div class="upgrade-small-notification">Upgrade</div>
          </div>
          <div class="link" data-page="help-topics.html">
            <div class="db-nav-icon settings">
              <img src="../assets/img/dashboard/icons/users.png" alt="" class="Home" />
            </div>
            <div class="t20">Help</div>
          </div>
        </div>
      </div>
      <div class="col-md-10 col-sm-12 rhs-db">
        <div class="route-container" id="route-container">

        </div>
      </div>
    </div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>
<script>
  let componentsPath = './components/';
  const routeContainer = document.getElementById('route-container');
  let documentsList = [];

  getFileContents = async (element, name) => {
    let file = componentsPath + name;
    xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (this.readyState == 4) {
        if (this.status == 200) { element.innerHTML = this.responseText }
        if (this.status == 404) { element.innerHTML = "Page not found."; }
        element.removeAttribute("w3-include-html");
      }
    }
    xhttp.open("GET", file, false);
    await xhttp.send();
    setTimeout(function () {
      switch (name) {
        case 'overview.html': renderOverviewPage(); break;
        case 'make-document.html': renderMakeDocumentData();
          $('.make-document-page').addClass('width-70'); break;
        case 'my-documents.html': renderMyDocuments(); break
        case 'doc-business.html': initDocBusinessPage();
          break;
      }
    }, 1000);
    return;
  }

  let availableTemplatesMaxCount = 25;

  const initDocBusinessPage = () => {
    if(true) {
      $('.doc-business-page').addClass('blur');
    }
    getFileContents(document.getElementById('docsWrap'), 'make-document.html');
    setTimeout(() => {
      setTemplatesInfo();
      $('.csss1').show();
    }, 1000);
  }

  const setTemplatesInfo = () => {
    const selectedTemplateCount = $('.selectedDoc').length;
    $('#selectedTemplateCount').html(selectedTemplateCount);
    $('#availableTemplatesMaxCount').html(availableTemplatesMaxCount);
    $('#remainingTemplatesInfo').html(availableTemplatesMaxCount - selectedTemplateCount + ' more to go');
  }

  const renderMyDocuments = () => {
    const myDocuments = [
      { docName: 'Afidavit of marrige1', percentage: '10', status: 'inprogress' },
      { docName: 'Afidavit of marrige2', percentage: '20', name: 'Jeswin Jose', status: 'completed' },
      { docName: 'Afidavit of marrige1', percentage: '10', status: 'inprogress' },
      { docName: 'Afidavit of marrige2', percentage: '40', name: 'Jeswin Jose', status: 'completed' },
      { docName: 'Afidavit of marrige1', percentage: '60', name: 'Deepu S A', status: 'inprogress' },
      { docName: 'Afidavit of marrige2', percentage: '20', name: 'Jeswin Jose', status: 'completed' }
    ];
    let myDocumentsHtml = '';
    for (let doc of myDocuments) {
      const statusClass = doc.status == 'Completed' ? 'success' : 'fail';
      const status = doc.status == 'inprogress' ? 'In progress' : 'Completed';
      myDocumentsHtml += `<div class="mydoc-box d-flex box-style1">
            <div class="t20 col2 grey-text colm">${doc.docName}</div>
            <div class="doc-status col3 colm ${doc.status}-icon">

              <div class="t20">${status}</div>
            </div>
            <div class="colm">
              <div class="progress w-100 mt-2" style="height: 0.6rem;">
                <div class="progress-bar ${statusClass}" role="progressbar" style="width: ${doc.percentage}%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            </div>
      </div>`;
    }
    $('.my-documents-list').html(myDocumentsHtml);
    $(".my-documents-list").mCustomScrollbar();
  }

  loadHelpLandingPage = ()=> {
    getFileContents(routeContainer, 'help-topics.html');
  }

  $(document).ready(function () {
    init();
    $('.link').click(function () {
      const pageTobeLoaded = $(this).attr('data-page');
      getFileContents(routeContainer, pageTobeLoaded);
      $('.link').removeClass('active');
      $(this).addClass('active');
    });
    $(document).on('click', '.docCategory-toggle', function () {
      $('.docCategory-toggle').removeClass('active');
      $(this).addClass('active');
    });
    $(document).on('click', '.search-box', function () {
      const searchText = $('.input-style-text').val().toLowerCase();
      if (searchText !== '') {
        const filteredArray = documentsList.filter(el => el.tag.toLowerCase().indexOf(searchText) > -1);
        console.log(filteredArray);
        renderDocuments(filteredArray);
      } else {
        $('.docCategory-toggle.active').trigger('click');
      }
    });
    $(document).on('click', '.threedots-img', function () {
      $(this).next().toggle();
    });
    $(document).on('click', '.help-page .topicsList .box1', function () {
      const pageTobeLoaded = $(this).attr('data-page');
      getFileContents(routeContainer, pageTobeLoaded);
    });
    const businessDocListB = [];
    $(document).on('click', '.addToListB', function () {
      let docId = $(this).attr('data-docid');
      let name = $(this).attr('data-docname');
      if ($(`.selectedDoc.${docId}`).length == 0) {
        const html = `<div class="selectedDoc ${docId} d-flex" data-docid="${docId}">
          <div class="doc-icon mr-4">
            <img src="../assets/img/dashboard/icons/document.png" alt="" class="Document" />
          </div>
          <div class="t18">${name}</div><button class="btn-red deselectDoc ml-auto">Deselect</button>
        </div>`;
        $('#selectedDocs').append(html);
        setTemplatesInfo();
      }
    });
    $(document).on('click', '.deselectDoc', function () {
      let docId = $(this).closest('.selectedDoc').remove();
      setTemplatesInfo();
    });
    $(document).on('click', '.backToHelpLandingPage', function(){
      $('.link.active').trigger('click');
    });
  });

  const renderDocuments = (data) => {
    documentsList.length = 0;
    documentsList = [...data];


    let html = "", counter = 0;
    for (let item of data) {
      item.tag = item.tag.split('.')[0];
      const dateModified = item.lastUpdatedDate != null ? item.lastUpdatedDate : "";
      let btnElement = `<a href="../core/document-transit.html?docid=${item.id}&docname=${item.tag}&lastmodified=${item.lastUpdatedDate}">
              <button type="button" class="btn btn-green right-arrow">Cancel</button></a>`;
      if ($('.doc-business-page').length === 1) {
        $('.make-document-page').removeClass('width-70');
        btnElement = `<button type="button" data-docname="${item.tag}" data-docid="${item.id}" class="addToListB btn btn-green right-arrow">Select</button>`;
      }
      html += `<div class="doc">
            <div class="doc-icon">
              <img src="../assets/img/dashboard/icons/document.png" alt="" class="Document" />
            </div>
            <div class="left-container">
              ${item.tag}
            </div>
            ${btnElement}
            </div>`;
    }
    $("#docsList").html(html)
  }

  init = () => {
    componentsPath = componentsPath += 'documentation/';
    getFileContents(routeContainer, 'doc-business.html');
    javascriptExercixes();
  }

  javascriptExercixes = () => {
    let taskA = () => {
      return new Promise((res, rej) => {
        res('Task A ')
      })
    }
    let taskB = (msg) => {
      return new Promise((res, rej) => {
        res(msg + 'Task B ')
      })
    }
    let taskC = (msg) => {
      return new Promise((res, rej) => {
        res(msg + 'Task C ');
      })
    }
    taskA().then((res)=>{
      return taskB(res);
    }).then((res)=>{
      return taskC(res);
    }).then((res)=>{
      console.log(res + 'completed');
    })
  }

  const renderMakeDocumentData = async () => {
    const docCategories = await fetch('http://ezyhostings-001-site1.dtempurl.com/api/Master/GetAllCategorys/', {
      method: 'GET'
    })
      .then((response) => response.json())
      .then((response) => {
        return response.data;
      })
      .catch((error) => {
        return []
      });
    let html = "";
    for (let doc of docCategories) {
      html += `<div class="docCategory-toggle" onclick="getDocumentsOfCategory(${doc.categoryID});">${doc.categoryName}</div>`;
    }
    $("#docCategoryList").html(html);
    if (docCategories.length > 0) {
      setTimeout(() => {
        $('.docCategory-toggle').first().trigger('click');
      }, 500);
    }
  }

  getDocumentsOfCategory = (categoryId) => {
    $.ajax({
      url: "http://ezyhostings-001-site1.dtempurl.com/api/DocManagement/GetDocumentDropDownData/" + categoryId,
      type: 'GET',
      success: function (response) {
        renderDocuments(response.data);
        $(".scroll-element").mCustomScrollbar();
      }, error: function (err) {
        //alert(err);
      }
    });
  }

  const renderOverviewPage = () => {
    const inProgressDocs = [
      { docName: 'Afidavit of marrige1', name: 'Deepu S A' },
      { docName: 'Afidavit of marrige2', name: 'Jeswin Jose' }
    ];
    let inProgressHtml = '';
    for (let doc of inProgressDocs) {
      inProgressHtml += `<div class="inprogress-box d-flex box-style1">
        <div class="lhs1">
            <img src="../assets/img/dashboard/icons/doc-inprogress.png" alt="No Items">
          </div>
          <div class="rhs1 ml-4">
            <div class="t20">${doc.docName}</div>
            <div class="t18 mt-3 d-flex">
              <div class="t18 grey-text">${doc.name}</div>
              <div class="t18 ml-auto mt-2 green-text">Continue > </div>
            </div>
          </div>
      </div>`;
    }
    $('.inprogress-docs-wrap').html(inProgressHtml);
    const suggestionsDocs = [
      { docName: 'Afidavit of marrige' },
      { docName: 'Afidavit of marrige' }, { docName: 'Afidavit of marrige' }, { docName: 'Afidavit of marrige' }
    ];
    let suggestionsHtml = '';
    for (let doc of suggestionsDocs) {
      suggestionsHtml += `<div class="col-sm-12 col-md-6"><div class="suggestion-box d-flex box-style1">
        <div class="lhs1">
            <img src="../assets/img/dashboard/icons/document.png" alt="No Items">
          </div>
          <div class="rhs1 ml-4">
            <div class="t20">${doc.docName}</div>
          </div>
          <div class="rhs2 ml-auto">
            <img src="../assets/img/dashboard/icons/help-circle.png" alt="No Items">
          </div>
      </div></div>`;
    }
    $('.suggestions-docs-wrap').html(suggestionsHtml);
  }

  function includeHTML() {
    var z, i, elmnt, file, xhttp;
    z = document.getElementsByClassName("section");
    for (i = 0; i < z.length; i++) {
      elmnt = z[i];
      file = elmnt.getAttribute("w3-include-html");
      if (file) {
        getFileContents(elmnt, file);
      }
    }
  }
  includeHTML();
</script>

</html>